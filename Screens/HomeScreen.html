<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - PodsForSquads</title>
    <link rel="stylesheet" href="Styles/HomeStyle.css">
    <link rel="icon" type="image/png" href="Images+Videos/Website_Logo.png">
</head>

<body>
    <header>
        <div id="logo">PodsForSquads</div>
        <nav>
            <a id="Home" href="HomeScreen.html">Home</a>
            <a id="Upload" href="Upload.html">Upload</a>
            <a id="Playlists" href="Playlists.html">Playlists</a>
            <a id="Favorites" href="Favorites.html">Favorites</a>
            <a id="Community" href="Community.html">Community</a>
            <a id="Analytics" href="Analytics.html">Stats</a>
            <a id="Settings" href="Settings.html">Settings</a>
            <div id="logo">PodsForSquads</div>
            <nav>
                <a id="Home" href="HomeScreen.html">Home</a>
                <a id="Upload" href="Upload.html">Upload</a>
                <a id="Playlists" href="Playlists.html">Playlists</a>
                <a id="Favorites" href="Favorites.html">Favorites</a>
                <a id="Community" href="Community.html">Community</a>
                <a id="Analytics" href="Analytics.html">Stats</a>
                <a id="Settings" href="Settings.html">Settings</a>
            </nav>
            <div class="search-bar">
                <div class="search-wrapper">
                    <input type="text" placeholder="Search podcasts" id="searchInput" oninput="debouncedSearch()">
                    <button onclick="searchPodcasts()">
                        <img src="Images+Videos/search_1.png" alt="Search">
                    </button>
                </div>
                <div id="liveSearchResults" class="search-results-dropdown"></div>
            </div>
            <div class="dice-button" onclick="playRandomEpisode()">
                ðŸŽ²
            </div>
            <div class="profile-dropdown">
                <div class="profile-icon">
                    <img id="profileImage" src="./Images+Videos/DefaultProfile.png" alt="User Profile">
                    <i class="arrow down"></i>
                </div>
                <div class="dropdown-content">
                    <a href="Settings.html">View Profile</a>
                    <a href="Auth/Login.html">Log Out</a>
                </div>
            </div>
            <select id="languageSelector" onchange="changeLanguage(this.value)">
                <option value="English">English</option>
                <option value="Spanish">EspaÃ±ol</option>
            </select>
    </header>

    <div class="text-bar">
        <h1 class="moving-text">Welcome to PodsForSquads, The home for all your podcasting needs! We will soon be
            displaying
            more info on this text bar, so stay tuned for further updates and see whats to come with us! If you have an
            questions, please seek the contact form below by pressing the CONTACT button, and fill out the form and we
            will
            get back to you shortly!</span>
    </div>
    <div class="hero">
        <h1>Featured Podcasts</h1>
        <h1>Featured Podcasts</h1>
        <div class="carousel" id="featuredPodcasts"></div>
    </div>


    <div class="section">
        <h2>Trending Podcasts</h2>
        <div class="carousel" id="trendingPodcasts"></div>
    </div>


    <div class="section">
        <h2>Health Podcasts</h2>
        <div class="carousel" id="sciencePodcasts"></div>
    </div>

    <div class="section">
        <h2>Technology Podcasts</h2>
        <div class="carousel" id="technologyPodcasts"></div>
    </div>

    <div class="section">

        <div class="section">
            <h4>Uploaded Videos</h4>
            <div id="videoDisplay" class="video-list">
                <!-- Videos will be dynamically populated here -->
            </div>
        </div>

        <div id="podcastModal" class="modal" onclick="closeModal(event)">
            <div class="modal-content" onclick="event.stopPropagation()">
                <span class="close" onclick="closeModal(event)">&times;</span>
                <span class="close" onclick="closeModal(event)">&times;</span>
                <div id="modalContent"></div>
            </div>
        </div>

        <div id="searchModal" class="modal" onclick="closeSearchModal(event)">
            <div class="modal-content" onclick="event.stopPropagation()">
                <span class="close" onclick="closeSearchModal(event)">&times;</span>
                <span class="close" onclick="closeSearchModal(event)">&times;</span>
                <div id="searchResults" class="search-results"></div>
            </div>
        </div>

        <div id="playlistSelectionModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closePlaylistSelectionModal()">&times;</span>
                <h2>Select a Playlist</h2>
                <div id="playlistSelectionContent"></div>
            </div>
        </div>

        <button id="scrollToTopBtn" onclick="scrollToTop()" src="Arrow Up.png"></button>

        <div id="fixedPlayer" style="display: none; position: fixed; bottom: 0; left: 0; width: 100%; z-index: 1000;">
            <iframe id="fixedPlayerIframe" frameborder="0" width="100%" height="180" allow="autoplay"></iframe>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

        <footer>
            <div class="footer-links">
                <a href="About_Us.html">About Us</a>
                <a href="Contact.html">Contact</a>
                <a href="ToS.html">Terms of Service</a>
                <a href="PrivPol.html">Privacy Policy</a>
                <div class="footer-links">
                    <a href="About_Us.html">About Us</a>
                    <a href="Contact.html">Contact</a>
                    <a href="ToS.html">Terms of Service</a>
                    <a href="PrivPol.html">Privacy Policy</a>
                </div>
                <div class="social-media">
                    <a href="https://www.facebook.com/profile.php?id=61560365679571" target="_blank"><img
                            src="Images+Videos/FB Icon.jpg" alt="Facebook"></a>
                    <a href="https://x.com/PodsForSquads" target="_blank"><img src="Images+Videos/Twitter_Logo.png"
                            alt="Twitter"></a>
                    <a href="https://www.instagram.com/podsforsquads/" target="_blank"><img
                            src="Images+Videos/IG Icon.jpg" alt="Instagram"></a>
                </div>
        </footer>

        <!-- Updated script to fetch and display videos -->
        <script src="FirebaseConfig.js" type="module"></script>
        <script type="module">
            import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

            const db = getFirestore();

            async function fetchVideos() {
                const videosRef = collection(db, 'videos');
                const q = query(videosRef, orderBy('timestamp', 'desc')); // Fetch videos ordered by timestamp
                const querySnapshot = await getDocs(q);

                const videoContainer = document.getElementById('videoDisplay');
                videoContainer.innerHTML = ''; // Clear the container

                querySnapshot.forEach((doc) => {
                    const videoData = doc.data();
                    const videoElement = document.createElement('div');
                    videoElement.classList.add('video-item');
                    videoElement.innerHTML = `
                    <video controls src="${videoData.videoURL}" width="100%" height="auto"></video>
                    <h3>${videoData.publisher}</h3>
                    <p>${videoData.description}</p>
                `;
                    videoContainer.appendChild(videoElement);
                });
            }

            document.addEventListener('DOMContentLoaded', fetchVideos);
        </script>


        <script type="module">
            import { savePodcastToFirestore, deletePodcastFromFirestore } from './FirebaseConfig.js';

            const apiKey = 'cb2038d4dbd841b39dec5309c31b2d6a';
            const podcastLimit = 5;
            let activePodcastId = null;

            async function fetchPodcasts(endpoint, elementId) {
                const response = await fetch(`https://listen-api.listennotes.com/api/v2/${endpoint}`, {
                    method: 'GET',
                    headers: {
                        'X-ListenAPI-Key': apiKey
                    }
                });
                const data = await response.json();
                const container = document.getElementById(elementId);
                container.innerHTML = '';
                const response = await fetch(`https://listen-api.listennotes.com/api/v2/${endpoint}`, {
                    method: 'GET',
                    headers: {
                        'X-ListenAPI-Key': apiKey
                    }
                });
                const data = await response.json();
                const container = document.getElementById(elementId);
                container.innerHTML = '';

                data.podcasts.forEach(podcast => {
                    const podcastElement = document.createElement('div');
                    podcastElement.classList.add('podcast-item');
                    podcastElement.innerHTML = `
                    <img src="${podcast.thumbnail}" alt="${podcast.title}">
                    <h3>${podcast.title}</h3>
                    <p>${podcast.publisher}</p>
                `;
                    podcastElement.addEventListener('click', () => fetchPodcastDetails(podcast.id));
                    container.appendChild(podcastElement);
                });
            }

            async function fetchPodcastDetails(podcastId) {
                const response = await fetch(`https://listen-api.listennotes.com/api/v2/podcasts/${podcastId}`, {
                    method: 'GET',
                    headers: {
                        'X-ListenAPI-Key': apiKey
                    }
                });

                const podcast = await response.json();
                const modalContent = document.getElementById('modalContent');
                modalContent.innerHTML = `
               <div class="modal-header">
               <div class="modal-header">
                    <h2>${podcast.title}</h2>
                    <span class="heart-icon" onclick="toggleFavorite(this, '${podcast.id}', '${podcast.title}', '${podcast.thumbnail}', '${podcast.publisher}')">&#9825;</span>
                    <span class="add-to-playlist-icon" onclick="addToPlaylist('${podcast.id}', '${podcast.title}', '${podcast.thumbnail}', '${podcast.publisher}')">+</span>
                </div>
                <div class="podcast-details">
                    <img src="${podcast.thumbnail}" alt="${podcast.title}" class="podcast-thumbnail">
                    <a href="https://www.listennotes.com/c/${podcast.id}/embed/" target="_blank" class="play-button-image">
                        <img src="Images+Videos/play_button.png" alt="Play Podcast" class="play-button">
                    </a>
                </div>
                <p><strong>Publisher:</strong> ${podcast.publisher}</p>
                <p><strong>Description:</strong> ${podcast.description}</p>
                <p>To get the transcripts of the podcast, go to share in the player, copy the link and please go to this link: 
        <a href="https://www.listen411.com" target="_blank">Listen411</a>
    </p> `;
    </p > `;
            document.getElementById('podcastModal').style.display = 'block';

            document.getElementById('fixedPlayer').style.display = 'none';
            document.getElementById('fixedPlayerIframe').src = '';


            // Add event listener to the "+" button
            document.getElementById('addToPlaylistBtn').addEventListener('click', () => {
                addToPlaylist(podcast.id, podcast.title, podcast.thumbnail, podcast.publisher);
            });

            console.log("Add to playlist button set up");
            document.getElementById('podcastModal').style.display = 'block';
        }


        function closeModal(event) {
            document.getElementById('podcastModal').style.display = 'none';
            deactivateAudioPlayer();
            deactivateAudioPlayer();
        }

        function closeSearchModal(event) {
        function closeSearchModal(event) {
            document.getElementById('searchModal').style.display = 'none';
        }

        async function searchPodcasts() {
        async function searchPodcasts() {
            const query = document.getElementById('searchInput').value;
            const resultsContainer = document.getElementById('liveSearchResults');
            if (query.length === 0) {
                resultsContainer.innerHTML = '';
                resultsContainer.style.display = 'none'; // Hide if there's no query
                return;
            }

            try {
                const response = await fetch(`https://listen-api.listennotes.com/api/v2/search?q=${encodeURIComponent(query)}&type=podcast`, {
                method: 'GET',
                    headers: {
                    'X-ListenAPI-Key': 'cb2038d4dbd841b39dec5309c31b2d6a'
                }
            });

            if (response.ok) {
                const data = await response.json();
                const podcasts = data.results;

                resultsContainer.innerHTML = '';
                resultsContainer.style.display = 'block'; // Show results container

                if (podcasts.length > 0) {
                    podcasts.forEach(podcast => {
                        const podcastElement = document.createElement('div');
                        podcastElement.classList.add('search-result-item');
                        podcastElement.innerHTML = `
                        <img src="${podcast.thumbnail}" alt="${podcast.title_original}" class="search-result-img">
                        <div>
                            <h3>${podcast.title_original}</h3>
                            <p>${podcast.publisher_original}</p>
                        </div>
                    `;
                        podcastElement.addEventListener('click', () => {
                            fetchPodcastDetails(podcast.id); // Fetch podcast details and open modal
                            closeSearchResults(); // Close live search results after selection
                        });
                        resultsContainer.appendChild(podcastElement);
                    });
                } else {
                    resultsContainer.innerHTML = `<p>No results found.</p>`;
                }
            }
            } catch (error) {
                console.error('Error fetching podcasts:', error);
                resultsContainer.innerHTML = '<p>Error fetching search results. Please try again later.</p>';
            }
        }

            function closeSearchResults() {
                const resultsContainer = document.getElementById('liveSearchResults');
                resultsContainer.innerHTML = '';
                resultsContainer.style.display = 'none';
            }

            function handleKeyPress(event) {
                if (event.key === 'Enter') {
                    searchPodcasts();
                }
            }



            async function fetchRandomPodcast() {
                console.log('Fetching random podcast...');
                console.log('Fetching random podcast...');
                try {
                    const response = await fetch('https://listen-api.listennotes.com/api/v2/just_listen', {
                        method: 'GET',
                        headers: {
                            'X-ListenAPI-Key': apiKey
                        }
                    });

                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }

                    const data = await response.json();
                    console.log('Random podcast data:', data);
                    console.log('Random podcast data:', data);
                    return data;
                } catch (error) {
                    console.error('Error fetching random podcast:', error);
                }
            }

            async function playRandomEpisode() {
                console.log('playRandomEpisode function called');
                console.log('playRandomEpisode function called');
                try {
                    const podcast = await fetchRandomPodcast();
                    console.log('Fetched podcast:', podcast);

                    if (!podcast) {
                        console.log('No podcast found');
                        return;
                    }

                    const fixedPlayer = document.getElementById('fixedPlayer');
                    const fixedPlayerIframe = document.getElementById('fixedPlayerIframe');

                    console.log('Fixed player element:', fixedPlayer);
                    console.log('Fixed player iframe element:', fixedPlayerIframe);

                    if (!fixedPlayer || !fixedPlayerIframe) {
                        console.error('Fixed player elements not found');
                        return;
                    }

                    const embedUrl = `https://www.listennotes.com/embedded/e/${podcast.id}`;
                    console.log('Setting iframe src to:', embedUrl);
                    fixedPlayerIframe.src = embedUrl;
                    fixedPlayer.style.display = 'block';
                    console.log('Fixed player display set to block');
                    console.log('Fixed player display set to block');
                } catch (error) {
                    console.error('Error playing random episode:', error);
                }
            }

            async function toggleFavorite(element, podcastId, title, thumbnail, publisher) {
                async function toggleFavorite(element, podcastId, title, thumbnail, publisher) {
                    element.classList.toggle('filled');
                    const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
                    const isFavorite = favorites.some(fav => fav.id === podcastId);

                    if (isFavorite) {
                        const updatedFavorites = favorites.filter(fav => fav.id !== podcastId);
                        localStorage.setItem('favorites', JSON.stringify(updatedFavorites));
                        await deletePodcastFromFirestore(podcastId);
                        await deletePodcastFromFirestore(podcastId);
                    } else {
                        const newFavorite = { id: podcastId, title: title, thumbnail: thumbnail, publisher: publisher };
                        favorites.push(newFavorite);
                        localStorage.setItem('favorites', JSON.stringify(favorites));
                        await handleSavePodcast(podcastId, title, thumbnail, publisher);
                    }
                }

                async function handleSavePodcast(podcastId, title, thumbnail, publisher) {
                    const podcast = {
                        id: podcastId,
                        title: title,
                        thumbnail: thumbnail,
                        publisher: publisher,
                        timestamp: new Date()
                    };
                    try {
                        await savePodcastToFirestore(podcast);
                        console.log("Podcast saved to Firestore successfully.");
                    } catch (error) {
                        console.error("Error saving podcast to Firestore:", error);
                        await handleSavePodcast(podcastId, title, thumbnail, publisher);
                    }
                }

                async function handleSavePodcast(podcastId, title, thumbnail, publisher) {
                    const podcast = {
                        id: podcastId,
                        title: title,
                        thumbnail: thumbnail,
                        publisher: publisher,
                        timestamp: new Date()
                    };
                    try {
                        await savePodcastToFirestore(podcast);
                        console.log("Podcast saved to Firestore successfully.");
                    } catch (error) {
                        console.error("Error saving podcast to Firestore:", error);
                    }
                }

                document.addEventListener('DOMContentLoaded', () => {
                    console.log('DOM fully loaded and parsed');
                    console.log('DOM fully loaded and parsed');
                    const carousels = document.querySelectorAll('.carousel');
                    carousels.forEach(carousel => {
                        let scrollAmount = 0;
                        const scrollStep = 1;
                        const scrollInterval = 30;
                        let scrollIntervalId;

                        function startScrolling() {
                            scrollIntervalId = setInterval(() => {
                                if (scrollAmount >= carousel.scrollWidth / 2) {
                                    scrollAmount = 0;
                                    carousel.scrollLeft = 0;
                                } else {
                                    scrollAmount += scrollStep;
                                    carousel.scrollLeft = scrollAmount;
                                }
                            }, scrollInterval);
                        }

                        function stopScrolling() {
                            clearInterval(scrollIntervalId);
                        }

                        carousel.addEventListener('mouseover', stopScrolling);
                        carousel.addEventListener('mouseout', startScrolling);

                        startScrolling();
                    });

                    fetchPodcasts('best_podcasts?genre_id=68', 'featuredPodcasts');
                    fetchPodcasts('best_podcasts?genre_id=93', 'trendingPodcasts');
                    fetchPodcasts('best_podcasts?genre_id=71', 'sciencePodcasts');
                    fetchPodcasts('best_podcasts?genre_id=98', 'technologyPodcasts');

                    fetchVideos();

                    const diceButton = document.getElementById('diceButton');
                    console.log('Dice button element:', diceButton);

                    if (diceButton) {
                        console.log('Adding click event listener to dice button');
                        diceButton.addEventListener('click', () => {
                            console.log('Dice button clicked');
                            playRandomEpisode();
                        });
                    } else {
                        console.error('Dice button not found in the DOM');
                    }
                });

                // Make functions globally accessible
                window.closeModal = closeModal;
                window.closeSearchModal = closeSearchModal;
                window.toggleFavorite = toggleFavorite;
                window.handleKeyPress = handleKeyPress;
                window.searchPodcasts = searchPodcasts;
                window.playRandomEpisode = playRandomEpisode;
        </script>

        <script>
            var mybutton = document.getElementById("scrollToTopBtn");

            window.onscroll = function () {
                scrollFunction();
            };



            async function addToPlaylist(podcastId, title, thumbnail, publisher) {
                const playlists = JSON.parse(localStorage.getItem('playlists')) || [];

                if (playlists.length === 0) {
                    alert('You have no playlists. Please create a playlist first.');
                    return;
                }

                const playlistSelect = document.createElement('select');
                playlists.forEach(playlist => {
                    const option = document.createElement('option');
                    option.value = playlist.id;
                    option.textContent = playlist.name;
                    playlistSelect.appendChild(option);
                });

                const result = await Swal.fire({
                    title: 'Add to Playlist',
                    html: playlistSelect,
                    showCancelButton: true,
                    confirmButtonText: 'Add',
                    cancelButtonText: 'Cancel'
                });

                if (result.isConfirmed) {
                    const selectedPlaylistId = playlistSelect.value;
                    const selectedPlaylist = playlists.find(p => p.id == selectedPlaylistId);

                    if (selectedPlaylist) {
                        const newPodcast = { id: podcastId, title, thumbnail, publisher };
                        selectedPlaylist.podcasts.push(newPodcast);
                        localStorage.setItem('playlists', JSON.stringify(playlists));
                        Swal.fire('Success', 'Podcast added to playlist', 'success');
                    }
                }
            }

            // Make the function globally accessible
            window.addToPlaylist = addToPlaylist;

            async function addPodcastToPlaylist(playlistId, podcastId, title, thumbnail, publisher) {
                const playlists = JSON.parse(localStorage.getItem('playlists')) || [];
                const playlist = playlists.find(p => p.id === parseInt(playlistId));
                if (playlist) {
                    if (!playlist.podcasts.some(p => p.id === podcastId)) {
                        const newPodcast = {
                            id: podcastId,
                            title: title,
                            thumbnail: thumbnail,
                            publisher: publisher
                        };
                        playlist.podcasts.push(newPodcast);
                        if (!playlist.coverImage || playlist.coverImage === 'default-playlist-image.jpg') {
                            playlist.coverImage = thumbnail;
                        }
                        localStorage.setItem('playlists', JSON.stringify(playlists));
                        alert(`"${title}" has been added to "${playlist.name}"`);
                    } else {
                        alert(`"${title}" is already in "${playlist.name}"`);
                    }
                } else {
                    alert('Playlist not found');
                }

                closePlaylistSelectionModal();
            }
            function closePlaylistSelectionModal() {
                document.getElementById('playlistSelectionModal').style.display = 'none';
            }

            function scrollFunction() {
                if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                    mybutton.style.display = "block";
                } else {
                    mybutton.style.display = "none";
                }
            }

            function scrollToTop() {
                document.body.scrollTop = 0;
                document.documentElement.scrollTop = 0;
            }
        </script>

        <script src="LightDarkMode.js"></script>
        <script src="Language.js"></script>
        <script src="Search.js"></script>

        <script>
                console.log("addToPlaylist function is globally accessible:", typeof window.addToPlaylist === 'function');
        </script>
</body>

</html>